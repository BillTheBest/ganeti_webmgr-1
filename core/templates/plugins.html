<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd"
    >
<html lang="en">
<head>
    <title></title>
    
    <style>
        * { font-family: Helvetica, Arial, Tahoma; font-size: 12px;  padding: 0; margin: 0;}
        body {padding:20px;}
        
        #plugins {
            width:200px;
            margin:0;
        }
        
        #plugins li {
            border: 1px solid #bbbbbb;
            margin:1px;
            padding:6px;
            list-style:none;
        }
    
        #plugins li.enabled {
            background-color:#c2e192;
        }
        
        #plugins li.disabled {
            color:#666666;
        }

        #plugins input {
            float:right;
        }
    
    
        .form {
            background-color:rgba(100, 100, 100, 0.4);
            display:none;
            margin-left:auto;
            margin-right:auto;
            margin-top:40px;
            min-width:300px;
            padding:8px;
            position:absolute;
            text-align:center;
            top:140px;
            -moz-border-radius: 10px;
            -webkit-border-radius: 10px;
        }

        .inner {
            background-color:white;
            padding:15px;
            border:1px solid #333333;
            opacity: 1;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
        }

        .form h2, .form h2 span { font-size:115%; }
        .form h2 .plugin{ font-weight:normal;border-bottom: 1px solid #666666;}

        .form td { border:0px; }
        .form .description { 
            border-bottom: 1px solid #666666;
            color:#444444;
            font-size:95%;
            margin-bottom:15px;
            text-align:justify;
        }
        .form label { color:#444444; font-size:90%; font-weight:bold }
        .form button { margin-top:10px; }
        .form .button_close {
            position:absolute;
            top:12px;
            right:7px;
        }
        .messages ul {margin-left:25px; margin-top:10px; text-align:left;}
        #enable.form h2 .label, #enable .messages li { color:green; }
        #disable.form h2 .label, #disable .messages li { color:#c83737; }

    
    </style>
    
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
                $('#plugins li.disabled').live('click', function(){
                        $(this).children('input').attr('checked',false);
                        $('#enable h2 .plugin').html(this.id);
                        $.getJSON('{{ROOT}}/plugin/depends', {'name':this.id}, process_depends);
                    });
                
                $('#plugins li.enabled').live('click', function(){
                        $(this).children('input').attr('checked',true);
                        $('#disable h2 .plugin').html(this.id);
                        $.getJSON('{{ROOT}}/plugin/dependeds', {'name':this.id}, process_dependeds);
                    });
                
                $('#enable button').click(function(){
                        name = $('#enable h2 .plugin').html();
                        $.getJSON('{{ROOT}}/plugin/enable', {'name':name}, process_enabled);
                        $('#enable').hide();
                    });
                
                $('#disable button').click(function(){
                        name = $('#disable h2 .plugin').html();
                        $.getJSON('{{ROOT}}/plugin/disable', {'name':name}, process_disabled);
                        $('#disable').hide();
                    });
            });
        
        function process_depends(data){
            /*
                processes a list of depends for a plugin prior to displaying
                a enable form.
            */
            
            if (data.length == 0) {
                $('#enable .messages').hide();
            } else {
                $('#enable .messages').show();
                $list = $('#enable .messages ul')
                $list.empty();
                for (i in data){
                    plugin = data[i];
                    $list.append('<li>'+plugin['name']+'</li>')
                }
            }
            $('#enable').show();
        }
        
        function process_enabled(data){
            /*
                processes a response from attempting to enable a plugin.  This
                will either update the interface on a success or display a list
                of errors
            */
            if (data != -1){
                for (i in data){
                    plugin = data[i];
                    $('#'+plugin)
                        .removeClass('disabled')
                        .addClass('enabled')
                        .children('input').attr('checked',true);
                }
            }
        }
        
        function process_dependeds(data){
            /*
                processes a list of dependeds for a plugin prior to displaying
                a disable form.
            */
            if (data.length == 0) {
                $('#disable .messages').hide();
            } else {
                $('#disable .messages').show();
                $list = $('#disable .messages ul')
                $list.empty();
                for (i in data){
                    plugin = data[i];
                    $list.append('<li>'+plugin['name']+'</li>')
                }
            }
            $('#disable').show()
        }
        
        function process_disabled(data){
            /*
                processes a response from attempting to disable a plugin.
            */
            if (data != -1){
                for (i in data){
                    plugin = data[i];
                    $('#'+plugin)
                        .removeClass('enabled')
                        .addClass('disabled')
                        .children('input').attr('checked',false);
                }
            }
        }
    </script>    
    
    
</head>
<body>
    
    {% for plugin in plugins %}
    <ul id="plugins">
        <li id="{{plugin.name}}" class="{%if plugin.enabled%}enabled{%else%}disabled{%endif%}">
            {{plugin.name}}
            <input type="checkbox" {%if plugin.enabled%}checked{%endif%}/>
        </li>
    </ul>
    {% endfor %}
    
    
    <div id="enable" class="form">
        <div class="inner">
            <div class="button_close button"></div>
            <h2><span class="label">Enable:</span> <span class="plugin"></span></h2>
            <div class="description"></div>
            <div class="messages">
            The following dependencies will also be enabled:
            <ul></ul>
            </div>
            <button class="button_enable">Enable</button>
        </div>
    </div>
    
    
    <div id="disable" class="form">
        <div class="inner">
            <div class="button_close button"></div>
            <h2><span class="label">Disable:</span> <span class="plugin"></span></h2>
            <div class="description"></div>
            <div class="messages">
                The following plugins depend on this plugin and will also be disabled:
                <ul</ul>
            </div>
            <button class="button_disable">Disable</button>
        </div>
    </div>
    
</body>
</html>
