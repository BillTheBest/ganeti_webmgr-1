{% extends "base.html" %}
{% load webmgr_tags %}

{% block title %}Cluster {{ cluster.id }}: {{ cluster.hostname|safe }}{% endblock %}
{% block content %}

<div class="ticket" id="ticket_{{ cluster.id }}">
<h1>Cluster: {{ cluster.hostname }}</h1>
<p><a href="{% url instance-create cluster.slug %}">Add Virtual Machine</a></p>
<h2>Information</h2>
{% with cluster.info as info %}
<ul>
<li>Architecture: {{ info.architecture.0 }}</li>
<li>Default hypervisor: {{ info.default_hypervisor }}</li>
<li>Available hypervisors: {{ info.enabled_hypervisors|join:", " }}</li>
<li>Master node: {{ info.master }}</li>
<li>Created: 
  {% if info.ctime %}
    {{ info.ctime|date }}
  {% else %}
    <em>unknown</em>
  {% endif %}
<li>Last modified: {{ info.mtime|date }}</li>
{% endwith %}

<h2>Instances</h2>
<table>
<tr>
  <th>Name</th>
  <th>Node</th>
  <th>Ram</th>
  <th>Disk Space</th>
  <th>VCPUs</th>
  <th>Status</th>
</tr>
{% for vm in cluster.virtual_machines.all %}
{% with vm.info as info %}
<tr>
  <td><a href="{% url instance-detail cluster.slug vm.hostname %}">{{ vm.hostname }}</a></td>
  <td>{{ info.pnode }}</td>
  <td>{{ vm.ram }}</td>
  <td>{{ vm.disk_size }}</td>
  <td>{{ vm.virtual_cpus }}</td>
    {% if info.admin_state %}
        {% if info.oper_state %}
        <td class="status-running">
        {% else %}
        <td class="status-error">
        {% endif %}
    {% else %}
        {% if info.oper_state %}
        <td class="status-error">
        {% else %}
        <td class="status-down">
        {% endif %}
    {% endif %}
    {{ info.status|render_instance_status }}</td>
{% endwith %}
{% endfor %}
</table>
</div>
{% endblock %}
