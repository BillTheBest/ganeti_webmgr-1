{% extends "base.html" %}

{% block title %}Create a new Virtual Machine{% endblock %}

{% block head %}
    <script src="{{MEDIA_URL}}/js/jquery.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            cluster = $("#id_cluster");
            owner = $("#id_owner");
            cluster.change(function() {
                id = $(this).children("option:selected").val();
                alert(id);
                $.getJSON('{ url instance-create-cluster-options %}', {'cluster_id':id},
                    function(data) {
                        alert(data);
                    });
            });
            owner.change(function() {
                    id = $(this).children("option:selected").val();
                    $.getJSON('{% url instance-create-cluster-choices %}',
                        {'group_id':id}, function(data) {
                            cluster.children().not(':first').remove();
                            $.each(data, function(i, item) {
                                    child = $("<option> </option>");
                                    child.attr('value', item[0]);
                                    child.attr('text', item[1]);
                                    cluster.append(child);
                            });
                    });
                    //cluster.trigger('change');
            });
            snode = $("#id_snode");
            disk_template = $("#id_disk_template");
            curSelection = $("#id_snode option:selected").index();
            if( disk_template.val() != 'drdb') {
                snode.parent().hide();
            }
            disk_template.change(function() {
                if( disk_template.val() == 'drdb') {
                    snode.parent().show();
                } else {
                    snode.parent().hide();
                }
            });
            snode.change(function() {
                if( snode.attr('readonly') ) {
                    $("#id_snode option:selected").removeAttr('selected');
                    $("#id_snode option").index(curSelection).attr('selected');
                }
            });
        });
    </script>
{% endblock %}

{% block content %}
<div id="virtualmachineform">
    <fieldset>
        <legend> New Virtual Machine </legend>
        <form method="post">
            {{ form.as_p }}
            <input class="submit" type="submit" value="Create">
        </form>
    </fieldset>
</div>
{% endblock %}