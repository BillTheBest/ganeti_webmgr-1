{% load webmgr_tags %}

{% if cluster %}
    <div class="add"><a href="{% url instance-create cluster.slug %}">Add Virtual Machine</a></div>
{% else %}
    <div class="add"><a href="{% url instance-create %}">Add Virtual Machine</a></div>
{% endif %}
<table>
    <tr>
      <th></th>
      <th>Name</th>
      {% if not cluster %}
      <th>Cluster</th>
      {% endif %}
      <th>Node</th>
      <th>Ram</th>
      <th>Disk Space</th>
      <th>VCPUs</th>
      <th>Status</th>
    </tr>
    {% for vm in vms %}
    {% with vm.info as info %}
    <tr>
        <td class="error">
            {% if vm.error %}
            <div class="icon_error" title="Ganeti API Error: {{vm.error}}"></div>
            {% endif %}
        </td>
        <td class="name">
            <a href="{% url instance-detail vm.cluster.slug vm.hostname %}">{{ vm.hostname }}</a>
        </td>
        {% if not cluster %}
            <td>{{ vm.cluster }}</td>
        {% endif %}
        <td>{{ info.pnode }}</td>
        <td>{{ vm.ram|render_storage }}</td>
        <td>{{ vm.disk_size|render_storage }}</td>
        <td>{{ vm.virtual_cpus }}</td>
        {% if info.admin_state %}
            {% if info.oper_state %}
                <td class="status-running">
            {% else %}
                <td class="status-error">
            {% endif %}
            {% else %}
            {% if info.oper_state %}
                <td class="status-error">
            {% else %}
                <td class="status-down">
            {% endif %}
        {% endif %}
        {{ info.status|render_instance_status }}</td>
    {% endwith %}
    {% empty %}
        <tr class="none"><td colspan="100%">No Virtual Machines</td></tr>
    {% endfor %}
</table>