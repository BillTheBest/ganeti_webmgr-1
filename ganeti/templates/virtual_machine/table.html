{% block head %}

<style>
    td.actions div.delete {
        float:none;
    }
    #content td.actions a, #content td.actions {
        padding:5px 0 0 0;
    }
    #vm-wrapper {
        margin-top: 40px;
    }
</style>

<script type="text/javascript" src="{{MEDIA_URL}}/js/jquery.ajax.delete.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}/js/jquery.tablesorter.min.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}/js/jquery.progressbar.js"></script>
<script type="text/javascript">
    var PBAR_CONF = {
        steps: 0,
        showText: true,
        textFormat: 'fraction',
        // XXX there's issue, bars doesn't scale the progress to the given width
        width: 120,
        boxImage: '/media/images/progressbar/progressbar.gif',
        barImage: {
            75:  '/media/images/progressbar/progressbg_red.gif',
            50: '/media/images/progressbar/progressbg_orange.gif',
            30: '/media/images/progressbar/progressbg_yellow.gif',
            0: '/media/images/progressbar/progressbg_green.gif',
        },
    };
    $(document).ready(function() {
        $("#vmlist").tablesorter();
    });

    function ajax_get_update() {
        $.get(url, function(results) {
           $('#vm-wrapper').html(results);
        }, "html");
    }

    $(document).ready( function() {
        $('.step-links #prev').click(function(e) {
            e.preventDefault();
            url = ($('.step-links #prev')[0].href);
          ajax_get_update();
        });
        $('.step-links #next').click(function(e) {
            e.preventDefault();
            url = ($('.step-links #next')[0].href);
            ajax_get_update();
        });
    });

    $(document).ajaxStop( function() {
        $('.step-links #prev').click( function(e) {
            e.preventDefault();
            url = ($('.step-links #prev')[0].href);
            ajax_get_update();
        });
        $('.step-links #next').click( function(e) {
            e.preventDefault();
            url = ($('.step-links #next')[0].href);
            ajax_get_update();
        });
    });
</script>
{% endblock %}

{% if cluster %}
    <a class="button add" href="{% url instance-create cluster.slug %}">Add Virtual Machine</a>
{% else %}
    {% if can_create %}
    <a class="button add" href="{% url instance-create %}">Add Virtual Machine</a>
    {% endif %}
{% endif %}

<div id="vm-wrapper">
{% include "virtual_machine/inner_table.html" %}
</div>