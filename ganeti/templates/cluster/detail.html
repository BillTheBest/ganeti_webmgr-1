{% extends "base.html" %}

{% block title %}Cluster {{ cluster.id }}: {{ cluster.hostname|safe }}{% endblock %}

{% block head %}
    <link href="{{MEDIA_URL}}/css/jquery-ui.css" rel="stylesheet" type="text/css"/>
    <style>
    .ui-widget-header {background:none; border-width:0 0 1px 0; -moz-border-radius:0px;}
    .ui-widget-content {border:0;}
    </style>
    <script src="{{MEDIA_URL}}/js/jquery-ui.min.js"></script>
    <script src="{{MEDIA_URL}}/js/jquery.progressbar.js"></script>
    <script type="text/javascript">
        var PBAR_CONF = {
            steps: 0,
            showText: true,
            textFormat: 'fraction',
            boxImage: '/media/images/progressbar/progressbar.gif',
            barImage: {
                0:  '/media/images/progressbar/progressbg_red.gif',
                30: '/media/images/progressbar/progressbg_orange.gif',
                50: '/media/images/progressbar/progressbg_yellow.gif',
                75: '/media/images/progressbar/progressbg_green.gif',
            }
        };
        
        $(document).ready(function() {
            $('#tabs').tabs({ 
                spinner: false,
                select: function(event, ui) {
                    var tabID = "#ui-tabs-"+(ui.index);
                    $(tabID).html("<div class='spinner'>Loading...<img src='{{MEDIA_URL}}/images/ajax-loader.gif'></div>");
                },
                ajaxOptions: {
                    error: function(xhr, status, index, anchor) {
                        $(anchor.hash).html("Couldn't load this tab. We'll try to fix this as soon as possible.");
                    }
                }
            });
        });
    </script>
{% endblock %}

{% block content %}
<h1>Cluster: {{ cluster.hostname }}</h1>

<ul id="messages">
    {%if cluster.error%}<li class="error">Error in Ganeti API:<p>{{cluster.error}}</p></li>{%endif%}
</ul>

<div id="tabs">
    <ul id="tabs">
        <li><a href="#tab1"><span>Overview</span></a></li>
        <li><a href="{% url cluster-vms cluster.slug %}"><span>Virtual Machines</span></a></li>
        <li><a href="{% url cluster-nodes cluster.slug %}"><span>Nodes</span></a></li>
        {% if admin %}<li><a href="{% url cluster-users cluster.slug %}"><span>Users</span></a></li>{%endif%}
    </ul>
    <div id="tab1" class="tab_content">
        <div class="ticket" id="ticket_{{ cluster.id }}">
            {% with cluster.info as info %}
            <ul>
            <li>Architecture: {{ info.architecture.0 }}</li>
            <li>Default hypervisor: {{ info.default_hypervisor }}</li>
            <li>Available hypervisors: {{ info.enabled_hypervisors|join:", " }}</li>
            <li>Master node: {{ info.master }}</li>
            <li>Created: 
              {% if cluster.ctime %}
                {{ cluster.ctime|date }}
              {% else %}
                <em>unknown</em>
              {% endif %}
            <li>Last modified: {{ cluster.mtime|date }}</li>
            {% endwith %}
        </div>
    </div>
</div>
{% endblock %}
